<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Harmony Clicker: Arcade Edition</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        #game-container { display: flex; gap: 40px; background: #222; padding: 30px; border-radius: 20px; border: 2px solid #d4af37; box-shadow: 0 0 30px rgba(0,0,0,0.5); position: relative; }
        
        /* Left Side: Clicking */
        #click-section { text-align: center; width: 300px; }
        #note-btn { font-size: 80px; background: none; border: none; cursor: pointer; transition: 0.1s; user-select: none; }
        #note-btn:active { transform: scale(0.9); }
        #harmony-display { font-size: 32px; color: #d4af37; font-weight: bold; margin: 20px 0; }
        #hps-display { font-size: 18px; color: #bbb; }
        #hpc-display { font-size: 14px; color: #00ffff; margin-top: 5px; }
        
        /* Right Side: Upgrades */
        #upgrade-section { width: 300px; display: flex; flex-direction: column; gap: 10px; }
        .upgrade { background: #333; border: 1px solid #444; padding: 10px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .upgrade:hover { background: #444; border-color: #d4af37; }
        .upgrade h4 { margin: 0; color: #00ffff; }
        .upgrade p { margin: 5px 0 0 0; font-size: 12px; color: #bbb; }

        /* Golden Note */
        #golden-note { 
            position: absolute; font-size: 50px; cursor: pointer; display: none; 
            z-index: 100; filter: drop-shadow(0 0 15px gold); animation: pulse 1s infinite;
            user-select: none;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }

        /* Buttons */
        #hub-trigger { position: absolute; bottom: 20px; right: 20px; background: #ff0000; color: white; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; border: none; }
        #back-trigger { position: absolute; top: 20px; left: 20px; background: #444; color: white; padding: 8px 15px; border-radius: 5px; text-decoration: none; font-size: 14px; border: 1px solid #666; }
        
        /* Modal */
        #modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #000; padding: 30px; border: 3px solid #d4af37; border-radius: 15px; text-align: center; display: none; z-index: 1000; }
        .btn { display: block; width: 100%; padding: 12px; margin: 10px 0; font-weight: bold; text-decoration: none; border-radius: 5px; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <a id="back-trigger" href="https://puppyplaz2019.github.io/Arcade-HUB/">‚Üê BACK TO HUB</a>
    <div id="golden-note" onclick="hitGoldenNote()">‚ú®üéµ</div>

    <div id="game-container">
        <div id="click-section">
            <div id="harmony-display">0 Harmony</div>
            <button id="note-btn">üéµ</button>
            <p id="hps-display">0 Harmony / sec</p>
            <p id="hpc-display">+1 Per Click</p>
        </div>

        <div id="upgrade-section">
            <div class="upgrade" onclick="buyClickUpgrade()">
                <h4>Sharper Tuning</h4>
                <p>Cost: <span id="click-cost">25</span> | +1 Per Click</p>
            </div>
            <div class="upgrade" onclick="buyUpgrade(0)">
                <h4>Flute Player</h4>
                <p>Cost: <span id="cost0">15</span> | +1 Harmony/sec</p>
            </div>
            <div class="upgrade" onclick="buyUpgrade(1)">
                <h4>Trumpet Section</h4>
                <p>Cost: <span id="cost1">100</span> | +5 Harmony/sec</p>
            </div>
            <div class="upgrade" onclick="buyUpgrade(2)">
                <h4>ESOFA Orchestra</h4>
                <p>Cost: <span id="cost2">500</span> | +20 Harmony/sec</p>
            </div>
        </div>
    </div>

    <button id="hub-trigger" onclick="showModal()">SPONSOR HUB</button>

    <div id="modal">
        <h2 style="color:#d4af37;">MASTER MUSICIAN!</h2>
        <p>Support the real pros:</p>
        <a class="btn" style="background:#ff0000;" href="https://www.youtube.com/@SancoOutdoors" target="_blank">üé¨ SUB TO SANCO</a>
        <a class="btn" style="background:#d4af37; color:black;" href="https://www.sanangelogives.org/organization/emmanuelschooloffinearts" target="_blank">üéª TIP THE SCHOOL</a>
        <button class="btn" style="background:#333;" onclick="resetSave()">‚ö†Ô∏è RESET PROGRESS</button>
        <button onclick="hideModal()" style="background:none; border:none; color:#555; cursor:pointer; margin-top:10px;">[ BACK TO CLICKING ]</button>
    </div>

    <script>
        // Default Stats
        const defaultUpgrades = [
            { name: "Flute", cost: 15, power: 1, count: 0, increase: 10 },
            { name: "Trumpet", cost: 100, power: 5, count: 0, increase: 50 },
            { name: "Orchestra", cost: 500, power: 20, count: 0, increase: 200 }
        ];

        // Load or Initialize
        let harmony = parseInt(localStorage.getItem('notes_collected')) || 0;
        let clickPower = parseInt(localStorage.getItem('click_power')) || 1;
        let clickCost = parseInt(localStorage.getItem('click_cost')) || 25;
        let upgrades = JSON.parse(localStorage.getItem('clicker_upgrades')) || defaultUpgrades;

        // Data Fixer (Prevents NaN)
        upgrades = upgrades.map((u, i) => {
            if (isNaN(u.cost) || u.increase === undefined) return defaultUpgrades[i];
            return u;
        });

        let hps = 0;
        const goldenNote = document.getElementById('golden-note');

        // Clicking Logic
        document.getElementById('note-btn').onclick = () => {
            harmony += clickPower;
            updateDisplay();
        };

        function buyClickUpgrade() {
            if (harmony >= clickCost) {
                harmony -= clickCost;
                clickPower++;
                clickCost += 25; 
                updateDisplay();
                saveGame();
            }
        }

        function buyUpgrade(idx) {
            if (harmony >= upgrades[idx].cost) {
                harmony -= upgrades[idx].cost;
                upgrades[idx].count++;
                upgrades[idx].cost += upgrades[idx].increase; 
                calculateHPS();
                updateDisplay();
                saveGame();
            }
        }

        function calculateHPS() {
            hps = upgrades.reduce((total, u) => total + (u.count * u.power), 0);
            document.getElementById('hps-display').innerText = `${hps} Harmony / sec`;
        }

        function updateDisplay() {
            document.getElementById('harmony-display').innerText = `${Math.floor(harmony)} Harmony`;
            document.getElementById('hpc-display').innerText = `+${clickPower} Per Click`;
            document.getElementById('click-cost').innerText = clickCost;
            document.getElementById('cost0').innerText = upgrades[0].cost;
            document.getElementById('cost1').innerText = upgrades[1].cost;
            document.getElementById('cost2').innerText = upgrades[2].cost;
        }

        // Golden Note Logic
        function spawnGoldenNote() {
            const x = Math.random() * (window.innerWidth - 100);
            const y = Math.random() * (window.innerHeight - 100);
            goldenNote.style.left = x + 'px';
            goldenNote.style.top = y + 'px';
            goldenNote.style.display = 'block';
            setTimeout(() => { goldenNote.style.display = 'none'; }, 5000);
        }

        function hitGoldenNote() {
            const bonus = Math.floor(harmony * 0.15) + 100;
            harmony += bonus;
            goldenNote.style.display = 'none';
            updateDisplay();
            saveGame();
            alert("‚ú® GOLDEN NOTE! ‚ú®\nYou just earned " + bonus + " Harmony!");
        }

        function saveGame() {
            localStorage.setItem('notes_collected', Math.floor(harmony));
            localStorage.setItem('click_power', clickPower);
            localStorage.setItem('click_cost', clickCost);
            localStorage.setItem('clicker_upgrades', JSON.stringify(upgrades));
        }

        function resetSave() {
            if(confirm("Are you sure? This resets everything but your Harmony count!")) {
                localStorage.removeItem('click_power');
                localStorage.removeItem('click_cost');
                localStorage.removeItem('clicker_upgrades');
                location.reload();
            }
        }

        function showModal() { document.getElementById('modal').style.display = 'block'; }
        function hideModal() { document.getElementById('modal').style.display = 'none'; }

        // Start Up
        calculateHPS();
        updateDisplay();

        // Game Loops
        setInterval(() => { 
            if (hps > 0) {
                harmony += hps / 10; 
                updateDisplay(); 
            }
        }, 100);
        
        setInterval(saveGame, 5000);
        setInterval(() => { if(Math.random() < 0.3) spawnGoldenNote(); }, 15000);
    </script>
</body>
</html>
